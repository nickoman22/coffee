<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Office Coffee Fund</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg-main: #15161a;
      --card-bg: rgba(15, 16, 20, 0.9);
      --accent: #ff7b3a;
      --accent-dark: #ff4f1f;
      --text-main: #f9fafb;
      --text-muted: #d1d5db;
      --danger: #f97373;
      --border: rgba(249, 115, 22, 0.7);
      --good: #4ade80;
      --shadow-strong: 0 20px 45px rgba(0, 0, 0, 0.75);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
      color: var(--text-main);
      background-color: var(--bg-main);
      background-image: url("wallpaper.jpg");
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
    }

    .card {
      width: 100%;
      max-width: 620px;
      background: var(--card-bg);
      backdrop-filter: blur(10px);
      border-radius: 24px;
      padding: 24px 18px 18px;
      box-shadow: var(--shadow-strong);
      border: 1px solid var(--border);
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top left, rgba(255, 123, 58, 0.22), transparent 60%);
      pointer-events: none;
      mix-blend-mode: screen;
    }

    .badge {
      position: absolute;
      top: 16px;
      right: 18px;
      background: rgba(255, 123, 58, 0.22);
      color: #ffe5d1;
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-weight: 600;
      border: 1px solid rgba(249, 115, 22, 0.6);
    }

    .title-row {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 10px;
      position: relative;
      z-index: 1;
    }

    .coffee-icon {
      font-size: 30px;
      filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.7));
    }

    h1 {
      font-size: 24px;
      line-height: 1.1;
      letter-spacing: 0.03em;
    }

    .subtitle {
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: 18px;
      position: relative;
      z-index: 1;
    }

    .settings {
      display: flex;
      gap: 12px;
      align-items: flex-end;
      flex-wrap: wrap;
      margin-bottom: 14px;
      position: relative;
      z-index: 1;
    }

    .field-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
      min-width: 110px;
    }

    label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
      font-weight: 600;
    }

    input[type="number"],
    input[type="text"] {
      padding: 6px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      font-size: 13px;
      outline: none;
      background: rgba(15, 23, 42, 0.7);
      color: var(--text-main);
    }

    input[type="number"]:focus,
    input[type="text"]:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(248, 180, 72, 0.5);
    }

    .summary {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 12px;
      font-size: 13px;
      position: relative;
      z-index: 1;
    }

    .summary-block {
      padding: 6px 10px;
      border-radius: 14px;
      background: rgba(15, 23, 42, 0.75);
      border: 1px solid rgba(148, 163, 184, 0.6);
      min-width: 150px;
    }

    .summary-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
      margin-bottom: 2px;
    }

    .summary-value {
      font-size: 14px;
      font-weight: 600;
    }

    .summary-value.positive {
      color: var(--good);
    }

    .summary-value.negative {
      color: var(--danger);
    }

    .people-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 8px;
      font-size: 13px;
      position: relative;
      z-index: 1;
    }

    .people-table thead {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
    }

    .people-table th,
    .people-table td {
      padding: 6px 4px;
      text-align: center;
      vertical-align: middle;
    }

    .people-table th:first-child,
    .people-table td:first-child {
      text-align: left;
    }

    .people-table tbody tr:nth-child(odd) {
      background: rgba(15, 23, 42, 0.55);
    }

    .people-table tbody tr:nth-child(even) {
      background: rgba(15, 23, 42, 0.3);
    }

    .name-cell {
      font-weight: 600;
    }

    .count-display {
      font-variant-numeric: tabular-nums;
      font-weight: 600;
    }

    button {
      border-radius: 999px;
      border: none;
      padding: 5px 8px;
      font-size: 11px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      transition: transform 0.07s ease, box-shadow 0.07s ease,
        background 0.15s ease, opacity 0.15s ease;
      white-space: nowrap;
    }

    button:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: none;
    }

    .btn-add {
      background: linear-gradient(135deg, var(--accent), var(--accent-dark));
      color: #fff;
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.7);
      min-width: 40px;
    }

    .btn-minus {
      background: rgba(51, 65, 85, 0.9);
      color: #e5e7eb;
      min-width: 36px;
    }

    .btn-deposit {
      background: rgba(34, 197, 94, 0.16);
      color: #bbf7d0;
      border: 1px solid rgba(74, 222, 128, 0.6);
      font-size: 11px;
    }

    .amount-cell {
      font-variant-numeric: tabular-nums;
    }

    .amount-net.positive {
      color: var(--good);
    }

    .amount-net.negative {
      color: var(--danger);
    }

    .btn-reset {
      margin-left: auto;
      display: inline-flex;
      background: rgba(248, 113, 113, 0.15);
      color: #fecaca;
      padding: 6px 12px;
      font-size: 11px;
      margin-top: 2px;
      border: 1px solid rgba(248, 113, 113, 0.7);
    }

    .btn-reset:hover {
      background: rgba(248, 113, 113, 0.25);
    }

    .backup-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
      justify-content: flex-end;
      position: relative;
      z-index: 1;
    }

    .btn-backup {
      background: rgba(59, 130, 246, 0.14);
      color: #bfdbfe;
      font-size: 11px;
      padding: 6px 10px;
      border: 1px solid rgba(96, 165, 250, 0.6);
    }

    .btn-backup:hover {
      background: rgba(59, 130, 246, 0.23);
    }

    .footer-note {
      text-align: center;
      margin-top: 8px;
      font-size: 11px;
      color: var(--text-muted);
      position: relative;
      z-index: 1;
    }

    .footer-note span {
      font-weight: 600;
      color: var(--accent);
    }

    @media (max-width: 640px) {
      .card {
        padding: 20px 12px 14px;
        border-radius: 20px;
      }

      h1 {
        font-size: 20px;
      }

      .settings {
        flex-direction: column;
        align-items: stretch;
      }

      .people-table th,
      .people-table td {
        padding: 4px 2px;
      }

      .backup-buttons {
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <main class="card">
    <div class="badge">Office Coffee Bank</div>

    <div class="title-row">
      <div class="coffee-icon">☕</div>
      <div>
        <h1>Office Coffee Bank</h1>
        <p class="subtitle">
          Where productivity meets caffeine.
        </p>
      </div>
    </div>

    <section class="settings">
      <div class="field-group">
        <label for="pricePerCoffee">Base price per coffee</label>
        <input
          type="number"
          id="pricePerCoffee"
          min="0"
          step="0.10"
          value="2.50"
        />
      </div>

      <div class="field-group">
        <label for="currency">Currency</label>
        <input
          type="text"
          id="currency"
          maxlength="3"
          value="€"
          style="max-width: 60px; text-align: center"
        />
      </div>
    </section>

    <section class="summary">
      <div class="summary-block">
        <div class="summary-title">Total coffees</div>
        <div class="summary-value" id="totalCoffees">0</div>
      </div>
      <div class="summary-block">
        <div class="summary-title">Total coffee cost</div>
        <div class="summary-value">
          <span id="totalCost">0.00</span><span id="currencyLabel">€</span>
        </div>
      </div>
      <div class="summary-block">
        <div class="summary-title">Total prepaid</div>
        <div class="summary-value positive">
          <span id="totalPrepaid">0.00</span><span>€</span>
        </div>
      </div>
    </section>

    <section>
      <table class="people-table">
        <thead>
          <tr>
            <th>Person</th>
            <th>Coffees</th>
            <th>Quick</th>
            <th>Cost&nbsp;€</th>
            <th>Prepaid&nbsp;€</th>
            <th>Net&nbsp;€</th>
          </tr>
        </thead>
        <tbody id="peopleBody">
          <!-- ITS -->
          <tr data-name="ITS">
            <td class="name-cell">ITS</td>
            <td><span class="count-display" id="count-ITS">0</span></td>
            <td>
              <button class="btn-add" data-action="add" data-name="ITS">+1</button>
              <button class="btn-minus" data-action="minus" data-name="ITS">−1</button>
            </td>
            <td class="amount-cell">
              <span id="cost-ITS">0.00</span>
            </td>
            <td class="amount-cell">
              <span id="prepaid-ITS">0.00</span><br />
              <button class="btn-deposit" data-action="deposit" data-name="ITS">Add €</button>
            </td>
            <td class="amount-cell">
              <span id="net-ITS" class="amount-net">0.00</span>
            </td>
          </tr>

          <!-- IDA -->
          <tr data-name="IDA">
            <td class="name-cell">IDA</td>
            <td><span class="count-display" id="count-IDA">0</span></td>
            <td>
              <button class="btn-add" data-action="add" data-name="IDA">+1</button>
              <button class="btn-minus" data-action="minus" data-name="IDA">−1</button>
            </td>
            <td class="amount-cell">
              <span id="cost-IDA">0.00</span>
            </td>
            <td class="amount-cell">
              <span id="prepaid-IDA">0.00</span><br />
              <button class="btn-deposit" data-action="deposit" data-name="IDA">Add €</button>
            </td>
            <td class="amount-cell">
              <span id="net-IDA" class="amount-net">0.00</span>
            </td>
          </tr>

          <!-- AV -->
          <tr data-name="AV">
            <td class="name-cell">AV</td>
            <td><span class="count-display" id="count-AV">0</span></td>
            <td>
              <button class="btn-add" data-action="add" data-name="AV">+1</button>
              <button class="btn-minus" data-action="minus" data-name="AV">−1</button>
            </td>
            <td class="amount-cell">
              <span id="cost-AV">0.00</span>
            </td>
            <td class="amount-cell">
              <span id="prepaid-AV">0.00</span><br />
              <button class="btn-deposit" data-action="deposit" data-name="AV">Add €</button>
            </td>
            <td class="amount-cell">
              <span id="net-AV" class="amount-net">0.00</span>
            </td>
          </tr>

          <!-- NKO -->
          <tr data-name="NKO">
            <td class="name-cell">NKO</td>
            <td><span class="count-display" id="count-NKO">0</span></td>
            <td>
              <button class="btn-add" data-action="add" data-name="NKO">+1</button>
              <button class="btn-minus" data-action="minus" data-name="NKO">−1</button>
            </td>
            <td class="amount-cell">
              <span id="cost-NKO">0.00</span>
            </td>
            <td class="amount-cell">
              <span id="prepaid-NKO">0.00</span><br />
              <button class="btn-deposit" data-action="deposit" data-name="NKO">Add €</button>
            </td>
            <td class="amount-cell">
              <span id="net-NKO" class="amount-net">0.00</span>
            </td>
          </tr>

          <!-- GSP -->
          <tr data-name="GSP">
            <td class="name-cell">GSP</td>
            <td><span class="count-display" id="count-GSP">0</span></td>
            <td>
              <button class="btn-add" data-action="add" data-name="GSP">+1</button>
              <button class="btn-minus" data-action="minus" data-name="GSP">−1</button>
            </td>
            <td class="amount-cell">
              <span id="cost-GSP">0.00</span>
            </td>
            <td class="amount-cell">
              <span id="prepaid-GSP">0.00</span><br />
              <button class="btn-deposit" data-action="deposit" data-name="GSP">Add €</button>
            </td>
            <td class="amount-cell">
              <span id="net-GSP" class="amount-net">0.00</span>
            </td>
          </tr>
        </tbody>
      </table>

      <button class="btn-reset" id="resetBtn">Reset all coffees</button>

      <div class="backup-buttons">
        <button class="btn-backup" id="exportBtn">Download backup</button>
        <button class="btn-backup" id="importBtn">Import backup</button>
        <input type="file" id="importFile" accept=".json,application/json" style="display:none" />
      </div>
    </section>

    <p class="footer-note">
      Saved locally in this browser using <span>localStorage</span>.  
      Use <strong>Add €</strong> for pre-payments and backups to keep your data safe.
    </p>
  </main>

  <script>
    (function () {
      const STORAGE_KEY = "officeCoffeeFund_bank_v3";
      const members = ["ITS", "IDA", "AV", "NKO", "GSP"];

      let state = {
        price: 2.5,
        currency: "€",
        counts: {
          ITS: 0,
          IDA: 0,
          AV: 0,
          NKO: 0,
          GSP: 0,
        },
        prepaid: {
          ITS: 0,
          IDA: 0,
          AV: 0,
          NKO: 0,
          GSP: 0,
        },
        costs: {
          ITS: 0,
          IDA: 0,
          AV: 0,
          NKO: 0,
          GSP: 0,
        },
      };

      const priceInput = document.getElementById("pricePerCoffee");
      const currencyInput = document.getElementById("currency");

      const totalCoffeesEl = document.getElementById("totalCoffees");
      const totalCostEl = document.getElementById("totalCost");
      const totalPrepaidEl = document.getElementById("totalPrepaid");
      const currencyLabelEl = document.getElementById("currencyLabel");

      const resetBtn = document.getElementById("resetBtn");
      const peopleBody = document.getElementById("peopleBody");

      const exportBtn = document.getElementById("exportBtn");
      const importBtn = document.getElementById("importBtn");
      const importFileInput = document.getElementById("importFile");

      function migrateOldState(parsed) {
        const migrated = { ...parsed };
        if (!migrated.costs) {
          migrated.costs = {};
          const price = typeof migrated.price === "number" ? migrated.price : state.price;
          members.forEach((m) => {
            const count = (migrated.counts && typeof migrated.counts[m] === "number") ? migrated.counts[m] : 0;
            const extra =
              migrated.extra && typeof migrated.extra[m] === "number"
                ? migrated.extra[m]
                : 0;
            migrated.costs[m] = count * price + extra;
          });
        }
        return migrated;
      }

      function loadState() {
        try {
          const saved = localStorage.getItem(STORAGE_KEY);
          if (saved) {
            let parsed = JSON.parse(saved);
            parsed = migrateOldState(parsed);

            if (!parsed.counts) parsed.counts = {};
            if (!parsed.prepaid) parsed.prepaid = {};
            if (!parsed.costs) parsed.costs = {};

            members.forEach((m) => {
              if (typeof parsed.counts[m] !== "number") parsed.counts[m] = 0;
              if (typeof parsed.prepaid[m] !== "number") parsed.prepaid[m] = 0;
              if (typeof parsed.costs[m] !== "number") parsed.costs[m] = 0;
            });

            state = { ...state, ...parsed };
          }
        } catch (e) {
          console.warn("Could not load coffee fund data", e);
        }
      }

      function saveState() {
        try {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
        } catch (e) {
          console.warn("Could not save coffee fund data", e);
        }
      }

      function getTotalCoffees() {
        return members.reduce((sum, m) => sum + (state.counts[m] || 0), 0);
      }

      function getTotalCost() {
        return members.reduce((sum, m) => sum + (state.costs[m] || 0), 0);
      }

      function getTotalPrepaid() {
        return members.reduce((sum, m) => sum + (state.prepaid[m] || 0), 0);
      }

      function updateDisplay() {
        priceInput.value = state.price.toFixed(2);
        currencyInput.value = state.currency || "€";
        currencyLabelEl.textContent = state.currency || "€";

        members.forEach((m) => {
          const countEl = document.getElementById("count-" + m);
          const prepaidEl = document.getElementById("prepaid-" + m);
          const costEl = document.getElementById("cost-" + m);
          const netEl = document.getElementById("net-" + m);

          const count = state.counts[m] || 0;
          const prepaid = state.prepaid[m] || 0;
          const cost = state.costs[m] || 0;
          const net = cost - prepaid;

          if (countEl) countEl.textContent = count;
          if (prepaidEl) prepaidEl.textContent = prepaid.toFixed(2);
          if (costEl) costEl.textContent = cost.toFixed(2);
          if (netEl) {
            netEl.textContent = net.toFixed(2);
            netEl.classList.remove("positive", "negative");
            if (net < 0) {
              netEl.classList.add("positive");
            } else if (net > 0) {
              netEl.classList.add("negative");
            }
          }
        });

        const totalCoffees = getTotalCoffees();
        const totalCost = getTotalCost();
        const totalPrepaid = getTotalPrepaid();

        totalCoffeesEl.textContent = totalCoffees;
        totalCostEl.textContent = totalCost.toFixed(2);
        totalPrepaidEl.textContent = totalPrepaid.toFixed(2);
      }

      function changeCount(name, delta) {
        if (!state.counts[name] && state.counts[name] !== 0) {
          state.counts[name] = 0;
        }
        if (!state.costs[name] && state.costs[name] !== 0) {
          state.costs[name] = 0;
        }

        const newCount = Math.max(0, state.counts[name] + delta);
        const countDiff = newCount - state.counts[name];

        if (countDiff !== 0) {
          state.counts[name] = newCount;
          state.costs[name] = Math.max(0, state.costs[name] + countDiff * state.price);
        }

        saveState();
        updateDisplay();
      }

      function addDeposit(name, amount) {
        if (!state.prepaid[name] && state.prepaid[name] !== 0) {
          state.prepaid[name] = 0;
        }
        const newPrepaid = Math.max(0, state.prepaid[name] + amount);
        state.prepaid[name] = newPrepaid;
        saveState();
        updateDisplay();
      }

      priceInput.addEventListener("change", function () {
        const value = Number(String(priceInput.value).replace(",", "."));
        state.price = !isNaN(value) && value >= 0 ? value : 0;
        saveState();
        updateDisplay();
      });

      currencyInput.addEventListener("input", function () {
        state.currency = currencyInput.value.trim() || "€";
        saveState();
        updateDisplay();
      });

      peopleBody.addEventListener("click", function (event) {
        const btn = event.target.closest("button");
        if (!btn) return;

        const name = btn.getAttribute("data-name");
        const action = btn.getAttribute("data-action");
        if (!name || !action) return;

        if (action === "add") {
          changeCount(name, 1);
        } else if (action === "minus") {
          changeCount(name, -1);
        } else if (action === "deposit") {
          const current = state.prepaid[name] || 0;
          const answer = window.prompt(
            "How many euros to add to " + name + " prepaid bank?\n" +
            "(Positive number to add, negative to remove)\n\n" +
            "Current prepaid: " + current.toFixed(2) + " €"
          );
          if (answer === null) return;
          const amount = Number(String(answer).replace(",", "."));
          if (isNaN(amount)) {
            alert("That is not a valid number.");
            return;
          }
          addDeposit(name, amount);
        }
      });

      resetBtn.addEventListener("click", function () {
        const sure = window.confirm(
          "Reset all coffee counters back to 0?\nPrepaid amounts and total costs will NOT be reset."
        );
        if (!sure) return;
        members.forEach((m) => (state.counts[m] = 0));
        saveState();
        updateDisplay();
      });

      function downloadBackup() {
        const dataStr = JSON.stringify(state, null, 2);
        const blob = new Blob([dataStr], { type: "application/json" });
        const url = URL.createObjectURL(blob);

        const a = document.createElement("a");
        const today = new Date().toISOString().slice(0, 10);
        a.href = url;
        a.download = `coffee-bank-backup-${today}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }

      function applyImportedState(imported) {
        if (!imported || typeof imported !== "object") {
          alert("Invalid backup file.");
          return;
        }

        const newState = { ...state, ...imported };
        if (!newState.counts) newState.counts = {};
        if (!newState.prepaid) newState.prepaid = {};
        if (!newState.costs) newState.costs = {};

        members.forEach((m) => {
          if (typeof newState.counts[m] !== "number") newState.counts[m] = 0;
          if (typeof newState.prepaid[m] !== "number") newState.prepaid[m] = 0;
          if (typeof newState.costs[m] !== "number") newState.costs[m] = 0;
        });

        state = newState;
        saveState();
        updateDisplay();
        alert("Backup imported successfully!");
      }

      exportBtn.addEventListener("click", function () {
        downloadBackup();
      });

      importBtn.addEventListener("click", function () {
        importFileInput.value = "";
        importFileInput.click();
      });

      importFileInput.addEventListener("change", function () {
        const file = importFileInput.files && importFileInput.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function (e) {
          try {
            const text = e.target.result;
            const json = JSON.parse(text);
            applyImportedState(json);
          } catch (err) {
            console.error(err);
            alert("Could not read this backup file. Make sure it is a valid JSON backup from this page.");
          }
        };
        reader.readAsText(file);
      });

      loadState();
      updateDisplay();
    })();
  </script>
</body>
</html>
